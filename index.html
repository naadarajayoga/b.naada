<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Naada Raja Yoga</title>

  <!-- minimal: we intentionally do not include visual CSS for header/footer/navbar here.
       Their CSS lives inside the templates below or inside the container files. -->
  <style>
    /* minimal structural styles only (you said you don't want a common CSS) */
    :root{ --content-max-w:1100px }
    html,body{height:100%;margin:0;font-family:Arial,system-ui,-apple-system,Segoe UI,Roboto}
    img{max-width:100%;display:block}
    #page-root{min-height:100vh;display:flex;flex-direction:column}
    /* slots for injected header/footer/navbar (templates include visual CSS) */
    #header-slot,#navbar-slot,#footer-slot{width:100%}
    /* main dynamic area — containers will bring their own styles */
    main#app{width:100%;max-width:var(--content-max-w);margin:20px auto;padding:12px 18px;box-sizing:border-box;flex:1 0 auto}
    /* small loader style */
    .naada-loader{padding:24px;text-align:center;color:#666}
  </style>
</head>
<body>
  <div id="page-root">
    <!-- placeholders -->
    <div id="header-slot" aria-hidden="true"></div>
    <main id="app" role="main" aria-live="polite"></main>
    <div id="footer-slot" aria-hidden="true"></div>
    <div id="navbar-slot" aria-hidden="true"></div>
  </div>

  <!-- ======= TEMPLATES (header / navbar / footer) =======
       Each template contains its own CSS so you keep visual styles local.
       If you already maintain these as separate files, you can copy their contents here.
  -->

  <!-- header template (contains its own visual CSS) -->
  <template id="tmpl-header">
    <style>
      /* header visual styles (kept local inside template) */
      header{padding:20px;border-bottom:1px solid #eee;display:flex;justify-content:center}
      .branding{display:flex;gap:12px;align-items:center;max-width:1100px;width:100%;justify-content:center}
      .branding img{width:80px}
      .branding h1{font-family:'Marcellus',serif;margin:0;font-size:1.9rem}
      .branding p{font-family:'Playfair Display',serif;margin:0;color:#555;font-style:italic}
      @media (max-width:700px){ .branding img{width:65px} .branding h1{font-size:1.6rem} }
    </style>

    <header role="banner">
      <div class="branding">
        <img src="/images/Naada Raja Yoga Logo.png" alt="Naada Raja Yoga Logo">
        <div>
          <h1>Naada Raja Yoga</h1>
          <p>Personalized Yoga Journey</p>
        </div>
      </div>
    </header>
  </template>

  <!-- navbar template (contains its own visual CSS) -->
  <template id="tmpl-navbar">
    <style>
      .bottom-navbar {
        position: fixed; left:0; right:0; bottom:0;
        height: 65px; display:flex; justify-content:center; align-items:center; gap:40px;
        background: linear-gradient(135deg,#2c3e50 0%,#34495e 100%); color:#ecf0f1;
        z-index: 9999; backdrop-filter: blur(10px); border-top:1px solid rgba(255,255,255,0.08);
      }
      .bottom-navbar .nav-item{display:inline-flex;flex-direction:column;align-items:center;gap:4px;padding:8px 12px;border-radius:12px;color:inherit;text-decoration:none;cursor:pointer;font-weight:600;position:relative;transition:all .25s}
      .bottom-navbar .nav-item::before{content:"";position:absolute;inset:0;border-radius:12px;background:rgba(243,156,18,0.08);opacity:0;transition:all .25s;z-index:-1}
      .bottom-navbar .nav-item:hover{transform:translateY(-3px);color:#f39c12}
      .bottom-navbar .nav-item:hover::before{opacity:1}
      .bottom-navbar svg{width:24px;height:24px;fill:currentColor}
      .bottom-navbar .nav-item.active{color:#f39c12}
      .bottom-navbar .nav-item.active svg{transform:scale(1.08);filter:drop-shadow(0 0 8px rgba(243,156,18,0.45))}
      @media (max-width:520px){ .bottom-navbar{height:70px;gap:10px;justify-content:space-around} .bottom-navbar svg{width:22px;height:22px} }
    </style>

    <nav class="bottom-navbar" id="site-navbar" role="navigation" aria-label="Main navigation">
      <a class="nav-item" href="#/contact" data-target="contact" aria-label="Contact">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M6.6 10.2a15.05 15.05 0 006.2 6.2l1.8-1.8a1 1 0 01.9-.24c1 .25 2 .38 3 .38a1 1 0 011 1v3a1 1 0 01-1 1C9.2 23 1 14.8 1 3a1 1 0 011-1h3a1 1 0 011 1c0 1.1.13 2.1.38 3a1 1 0 01-.24.9L6.6 10.2z"/></svg>
        <span>Contact</span>
      </a>

      <a class="nav-item" href="#/home" data-target="home" aria-label="Home">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" aria-hidden="true"><path d="M541 229.16l-61-52.06V56c0-13.25-10.75-24-24-24h-72c-13.25 0-24 10.75-24 24v24L314.4 43c-15.9-13.6-39.3-13.6-55.2 0L35 229.2c-9.9 8.4-11.1 23.3-2.7 33.2s23.3 11.1 33.2 2.7L96 232.1V456c0 30.9 25.1 56 56 56h96V360h80v152h96c30.9 0 56-25.1 56-56V232l30.6 26c9.9 8.4 24.8 7.1 33.2-2.7 8.4-9.9 7.1-24.8-2.7-33.2z"/></svg>
        <span>Home</span>
      </a>

      <a class="nav-item" href="#/courses" data-target="courses" aria-label="Courses">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" aria-hidden="true"><path d="M320 96a64 64 0 1 0 0-128 64 64 0 1 0 0 128zM528 352h-56l-41-82c-6-12-19-18-32-14s-21 16-19 29l20 99H240l20-99c2-13-5-25-19-29s-26 2-32 14l-41 82H112c-27 0-48 21-48 48s21 48 48 48h416c27 0 48-21 48-48s-21-48-48-48z"/></svg>
        <span>Courses</span>
      </a>
    </nav>
  </template>

  <!-- footer template (contains its own visual CSS) -->
  <template id="tmpl-footer">
    <style>
      .peek-footer{background:#fff;color:#000}
      .peek-footer__spacer{height:4px;width:100%}
      .peek-footer__hidden{max-width:1100px;margin:0 auto;padding:10px 18px;padding-bottom:calc(65px + 2px);text-align:center;box-sizing:border-box}
      .footer-links{display:flex;gap:16px;justify-content:center;flex-wrap:wrap}
      .footer-links a{color:#bdbdbd;text-decoration:none;padding:4px 6px;border-radius:6px}
      .footer-links a:hover{color:#000;text-decoration:underline}
    </style>

    <footer class="peek-footer" id="site-footer" aria-label="Site footer">
      <div class="peek-footer__spacer" aria-hidden="true"></div>
      <div class="peek-footer__hidden" role="region" aria-label="Footer expanded links">
        <nav class="footer-links" aria-label="Footer links">
          <a href="#/privacy" data-target="privacy">Privacy Policy</a>
          <a href="#/terms" data-target="terms">Terms &amp; Conditions</a>
          <a href="#/refund" data-target="refund">Refund Policy</a>
        </nav>
      </div>
    </footer>
  </template>

  <!-- ========== minimal runtime: inject static templates + fetch and inject containers ========== -->

  <script>
  (function(){
    // mapping of routeKey -> external file path
    const containerFiles = {
      home:    '/home.html',
      contact: '/contact.html',
      courses: '/courses.html',
      privacy: '/privacy.html',
      terms:   '/terms.html',
      refund:  '/refund.html'
    };

    const headerSlot = document.getElementById('header-slot');
    const navbarSlot = document.getElementById('navbar-slot');
    const footerSlot = document.getElementById('footer-slot');
    const app = document.getElementById('app');

    // simple in-memory cache for fetched container HTML
    const cache = {};

    // inject a template into the target slot and execute inline styles/scripts contained in slot
    function injectTemplate(templateId, slot) {
      const tpl = document.getElementById(templateId);
      if (!tpl) return;
      // clone and append
      const clone = tpl.content.cloneNode(true);
      slot.appendChild(clone);
      // execute inline scripts that are now in the slot
      const scripts = slot.querySelectorAll('script');
      scripts.forEach(oldScript => {
        const s = document.createElement('script');
        for (let i = 0; i < oldScript.attributes.length; i++) {
          const a = oldScript.attributes[i];
          s.setAttribute(a.name, a.value);
        }
        s.text = oldScript.textContent;
        oldScript.parentNode.replaceChild(s, oldScript);
      });
    }

    // inject static chrome
    function initChrome() {
      injectTemplate('tmpl-header', headerSlot);
      injectTemplate('tmpl-footer', footerSlot);
      injectTemplate('tmpl-navbar', navbarSlot);

      // after navbar exists, set up its click listener below
    }

    // helper: set active nav item by data-target
    function setActiveNav(name) {
      const nav = document.getElementById('site-navbar');
      if (!nav) return;
      nav.querySelectorAll('.nav-item').forEach(it => {
        if (it.dataset.target === name) it.classList.add('active'); else it.classList.remove('active');
      });
    }

    // show loader
    function showLoading() {
      app.innerHTML = '<div class="naada-loader">Loading…</div>';
      adjustSpacing();
    }

    // adjust #app padding-bottom so footer and navbar don't overlap content
    function adjustSpacing() {
      const nav = document.getElementById('site-navbar');
      const foot = document.getElementById('site-footer');
      const navH = nav ? nav.getBoundingClientRect().height : 0;
      const footH = foot ? foot.getBoundingClientRect().height : 0;
      const extra = 12;
      app.style.paddingBottom = Math.ceil(navH + footH + extra) + 'px';
    }
    window.addEventListener('resize', adjustSpacing);

    // fetch external container file and return HTML string
    async function fetchContainerFile(routeKey) {
      if (!containerFiles[routeKey]) throw new Error('Unknown route ' + routeKey);
      if (cache[routeKey]) return cache[routeKey];
      const url = containerFiles[routeKey];
      const res = await fetch(url, {cache: 'no-store'});
      if (!res.ok) throw new Error('Failed to fetch ' + url + ' (' + res.status + ')');
      const text = await res.text();
      cache[routeKey] = text;
      return text;
    }

    // parse HTML and extract the container element (by id ending with '-container')
    function extractContainerFragment(htmlText) {
      // Use template to parse HTML
      const tmp = document.createElement('template');
      tmp.innerHTML = htmlText;
      // Find first element whose id ends with "-container"
      const root = Array.from(tmp.content.children).find(el => el.id && el.id.endsWith('-container'));
      if (!root) {
        // If not found, we will inject entire parsed content
        return tmp.content;
      }
      // Create a fragment containing that root and its siblings maybe? We'll return only the root
      const frag = document.createDocumentFragment();
      frag.appendChild(root.cloneNode(true));
      return frag;
    }

    // Inject fragment into #app and execute scripts inside it
    function injectFragmentAndRunScripts(fragment) {
      // clear app
      while (app.firstChild) app.removeChild(app.firstChild);

      // Collect scripts from fragment, append others
      const scripts = [];
      Array.from(fragment.childNodes).forEach(node => {
        // If the node or its descendants contain script tags we must handle them.
        // We'll append node, then find script tags inside app and move them to head to execute.
        app.appendChild(node.cloneNode(true));
      });

      // Find and run scripts inside app (in-order)
      const appScripts = Array.from(app.querySelectorAll('script'));
      (function run(i){
        if (i >= appScripts.length) {
          // focus first heading
          const firstHeading = app.querySelector('h1, h2, [role="main"]');
          if (firstHeading) {
            firstHeading.setAttribute('tabindex', '-1');
            firstHeading.focus({preventScroll: true});
          }
          adjustSpacing();
          return;
        }
        const s = appScripts[i];
        const newScript = document.createElement('script');
        for (let j = 0; j < s.attributes.length; j++) {
          const a = s.attributes[j];
          newScript.setAttribute(a.name, a.value);
        }
        if (s.src) {
          newScript.src = s.src;
          newScript.onload = () => run(i+1);
          newScript.onerror = () => { console.error('Script load failed', s.src); run(i+1); };
          document.head.appendChild(newScript);
        } else {
          // inline
          newScript.text = s.textContent;
          document.head.appendChild(newScript);
          document.head.removeChild(newScript);
          run(i+1);
        }
      })(0);
    }

    // Load route by key (hash routing). pushHistory=false when handling popstate
    async function loadRoute(routeKey, pushHistory = true) {
      if (!containerFiles[routeKey]) routeKey = 'home';
      setActiveNav(routeKey);
      showLoading();

      try {
        const html = await fetchContainerFile(routeKey);
        const frag = extractContainerFragment(html);
        injectFragmentAndRunScripts(frag);

        // update hash (push only when requested)
        if (pushHistory) {
          // use hash like #/contact
          const newHash = '#/' + routeKey;
          if (location.hash !== newHash) location.hash = newHash;
        }
      } catch (err) {
        console.error(err);
        app.innerHTML = '<div class="naada-loader">Could not load content. Please try again later.</div>';
      }
    }

    // Determine route from location.hash
    function routeFromHash(h) {
      const hash = (h || location.hash || '#/home').replace(/^#\/?/, '');
      if (!hash) return 'home';
      if (containerFiles[hash]) return hash;
      // match keywords
      if (hash.includes('privacy')) return 'privacy';
      if (hash.includes('terms')) return 'terms';
      if (hash.includes('refund')) return 'refund';
      return 'home';
    }

    // Intercept clicks on navbar (delegated)
    function setupNavClicks() {
      const nav = document.getElementById('site-navbar');
      if (!nav) return;
      nav.addEventListener('click', (ev) => {
        const a = ev.target.closest('.nav-item');
        if (!a) return;
        ev.preventDefault();
        const key = a.dataset.target || routeFromHash(a.getAttribute('href'));
        if (!key) return;
        // if active clicked, scroll to top of app
        if (a.classList.contains('active')) {
          app.scrollIntoView({behavior: 'smooth'});
          return;
        }
        loadRoute(key, true);
      });
    }

    // Intercept footer links (delegated)
    function setupFooterClicks() {
      const foot = document.getElementById('site-footer');
      if (!foot) return;
      foot.addEventListener('click', (ev) => {
        const a = ev.target.closest('a[data-target]');
        if (!a) return;
        ev.preventDefault();
        const key = a.dataset.target;
        if (!key) return;
        loadRoute(key, true);
      });
    }

    // Intercept anchor clicks inside app to handle same-origin container links
    function setupAppLinkDelegation() {
      document.addEventListener('click', (ev) => {
        const a = ev.target.closest('a');
        if (!a) return;
        // ignore external, target=_blank, download
        if (a.target === '_blank' || a.hasAttribute('download')) return;
        const href = a.getAttribute('href');
        if (!href) return;
        // ignore fragment anchors
        if (href.startsWith('#')) return;
        let url;
        try { url = new URL(href, location.href); } catch (e) { return; }
        if (url.origin !== location.origin) return;
        // convert pathname to route key if matches; otherwise do nothing
        const path = url.pathname.replace(/^\/+|\/+$/g, '');
        const candidate = path || 'home';
        if (containerFiles[candidate]) {
          ev.preventDefault();
          loadRoute(candidate, true);
        }
      });
    }

    // handle hashchange/back-forward
    window.addEventListener('hashchange', () => {
      const route = routeFromHash(location.hash);
      loadRoute(route, false);
    });

    // initialize
    document.addEventListener('DOMContentLoaded', () => {
      initChrome();
      // small timeout to ensure navbar/footer elements exist
      setTimeout(() => {
        setupNavClicks();
        setupFooterClicks();
        setupAppLinkDelegation();
        adjustSpacing();
        // initial route from hash or default to 'home'
        const initial = routeFromHash(location.hash);
        loadRoute(initial, false);
      }, 0);
    });

    // expose for debugging
    window.__naada = { loadRoute, cache, containerFiles };
  })();
  </script>
</body>
</html>
